<!DOCTYPE html>
<html lang="ja">
<!-- PhotoCRM v2.2.3 - Fixed btoa encoding error - 2026-02-22 -->

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="appTitle">PhotoCRM - Professional Photographer CRM</title>
  <meta name="description"
    content="Customer management for photographers. Manage everything from inquiries to payments."
    data-i18n="metaDescription">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.svg">
  <meta name="theme-color" content="#8b5cf6">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<body>
  <div class="login-screen" id="login-screen" style="display:none;">
    <div class="login-card">
      <div class="login-logo">ğŸ“·</div>
      <h1>PhotoCRM</h1>
      <p>ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯Googleãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚</p>
      <button class="btn btn-primary btn-lg" id="btn-google-login-screen">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>
  </div>
  <div class="auth-banner" id="auth-banner">
    <div class="auth-status" id="auth-status">ğŸ”„ ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèªä¸­...</div>
    <div class="auth-actions">
      <button class="btn btn-primary btn-sm" id="btn-google-login">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button class="btn btn-secondary btn-sm" id="btn-logout" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </div>
  <div class="app-container" id="app-container">

    <!-- ===== Header ===== -->
    <header class="app-header">
      <div class="logo">
        <div class="logo-icon">ğŸ“·</div>
        <div class="logo-copy">
          <h1 id="app-title-fixed">é¡§å®¢ç®¡ç†</h1>
          <button class="stats-toggle-btn" id="btn-toggle-dashboard" type="button"
            title="çµ±è¨ˆã‚’éš ã™" aria-expanded="true">ğŸ“Š çµ±è¨ˆã‚’éš ã™</button>
          <div class="dashboard-quick-menu" id="dashboard-quick-menu" style="display:none;">
            <div class="dashboard-quick-menu-content" id="dashboard-quick-menu-content"></div>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <!-- Language Switcher -->
        <select id="lang-select" class="btn btn-secondary btn-sm" style="padding: 6px 8px; min-width:auto;">
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        </select>

        <button class="theme-toggle" id="btn-theme" title="Toggle Theme">ğŸŒ™</button>
        <button class="btn btn-secondary btn-sm" id="btn-settings" title="Settings" data-i18n="settings">âš™
          Settings</button>
        <button class="btn btn-secondary btn-sm" id="btn-sync-export" title="ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (JSON)" data-i18n="exportSync"
          data-i18n-title="exportSync">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (JSON)</button>
        <button class="btn btn-secondary btn-sm" id="btn-sync-import" title="ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ" data-i18n="importSync"
          data-i18n-title="importSync">ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</button>
        <input type="file" id="import-file" accept=".json" style="display:none;" />
        <button class="btn btn-secondary btn-sm" id="btn-ics-export" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº (iCal)" data-i18n="exportIcs"
          data-i18n-title="exportIcs">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº (iCal)</button>
        <button class="btn btn-secondary btn-sm" id="btn-export" title="å£²ä¸Šé›†è¨ˆ (CSV)" data-i18n="exportCsv"
          data-i18n-title="exportCsv">å£²ä¸Šé›†è¨ˆ (CSV)</button>
        <button class="btn btn-primary" id="btn-add" data-i18n="addCustomer">ï¼‹ Add New</button>
      </div>
    </header>

    <!-- ===== Dashboard ===== -->
    <div class="dashboard-collapsible" id="dashboard-collapsible">
      <div class="dashboard-period-controls" id="dashboard-period-controls">
        <button class="btn-icon" id="dashboard-prev-month" title="Previous month">â—€</button>
        <input type="month" id="dashboard-month-picker" aria-label="Dashboard month" />
        <button class="btn-icon" id="dashboard-next-month" title="Next month">â–¶</button>
      </div>

      <div class="dashboard stats-container" id="dashboard-cards-grid">
        <div class="stat-card" data-dashboard-key="totalCustomers">
          <div class="stat-icon">ğŸ‘¤</div>
          <div class="stat-info">
            <label data-i18n="cardTotalCustomers">Total Customers</label>
            <div class="stat-value" id="stat-total">0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="monthlyShoots">
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-info">
            <label data-i18n="cardMonthlyShoots">Monthly Shoots</label>
            <div class="stat-value" id="stat-monthly">0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="monthlyRevenue">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-info">
            <label data-i18n="cardMonthlyRevenue">Monthly Revenue</label>
            <div class="stat-value" id="stat-revenue">$0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="monthlyProfit">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-info">
            <label data-i18n="cardProfit">Profit</label>
            <div class="stat-value" id="profit-month">$0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="yearlyRevenue">
          <div class="stat-icon">ğŸ—“ï¸</div>
          <div class="stat-info">
            <label id="yearly-revenue-label" data-i18n="yearlyRevenueTotal">ä»Šå¹´ã®ç·å£²ä¸Š</label>
            <div class="stat-value" id="stat-yearly-revenue">$0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="yearlyExpense">
          <div class="stat-icon">ğŸ’¸</div>
          <div class="stat-info">
            <label id="yearly-expense-label" data-i18n="yearlyExpenseTotal">ä»Šå¹´ã®ç·çµŒè²»</label>
            <div class="stat-value" id="stat-yearly-expense">$0</div>
          </div>
        </div>
        <div class="stat-card" data-dashboard-key="yearlyProfit">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-info">
            <label id="yearly-profit-label" data-i18n="yearlyProfitTotal">ä»Šå¹´ã®ç·åˆ©ç›Š</label>
            <div class="stat-value" id="stat-yearly-profit">$0</div>
          </div>
        </div>
        <div class="stat-card pink" data-dashboard-key="unpaid">
          <div class="stat-icon">âš ï¸</div>
          <div class="stat-value" id="stat-unpaid">0</div>
          <div class="stat-label" data-i18n="cardUnpaid">Unpaid</div>
        </div>
      </div>
    </div>

    <!-- Expense Tracking Section -->
    <div class="expense-section" style="margin-top: 30px; margin-bottom: 30px; display: none;" id="expense-container">
      <div class="section-header"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="section-title" data-i18n="expenseTracking" style="margin-bottom: 0;">Expense Tracking</h2>
        <button class="btn btn-primary" id="openExpenseModalBtn" type="button" onclick="openExpenseModal()">
          <span data-i18n="addExpense">â• Add Expense</span>
        </button>
      </div>
      <div class="stat-grid"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 20px;">
        <div class="stat-card small">
          <label data-i18n="thisMonth">This Month</label>
          <div class="stat-value sm" id="expense-month">$0</div>
        </div>
        <div class="stat-card small">
          <label data-i18n="cardMonthlyRevenue">Revenue</label>
          <div class="stat-value sm" id="revenue-month">$0</div>
        </div>
        <div class="stat-card small">
          <label data-i18n="cardProfit">Profit</label>
          <div class="stat-value sm" id="profit-month-alt">$0</div>
        </div>
      </div>
      <div class="expense-list-container"
        style="background: var(--bg-card); border-radius: 16px; padding: 20px; border: 1px solid var(--border);">
        <div id="expense-list" class="expense-list"></div>
      </div>
    </div>
    <!-- ===== View Toggle ===== -->
    <div class="view-tabs">
      <div class="view-tab active" data-view="list" data-i18n="tabList">List</div>
      <div class="view-tab" data-view="calendar" data-i18n="tabCalendar">Calendar</div>
    </div>

    <!-- ===== List View ===== -->
    <div class="list-view active" id="list-view">
      <div class="toolbar">
        <div class="search-box">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="search-input" placeholder="ãŠå®¢æ§˜åãƒ»é€£çµ¡å…ˆã§æ¤œç´¢..." data-i18n-placeholder="searchPlaceholder" />
        </div>
        <select class="filter-select" id="filter-payment">
          <option value="all" data-i18n="filterAll">ã™ã¹ã¦</option>
          <option value="paid" data-i18n="filterPaid">å…¥é‡‘æ¸ˆã¿</option>
          <option value="unpaid" data-i18n="filterUnpaid">æœªå…¥é‡‘</option>
        </select>
        <select class="filter-select" id="filter-photographer">
          <option value="all" data-i18n="filterPhotographer">Filter by Staff</option>
        </select>
        <select class="filter-select" id="filter-month">
          <option value="all" data-i18n="filterPeriodAll">å…¨æœŸé–“</option>
        </select>
        <div class="list-columns-menu-wrap" id="list-columns-menu-wrap">
          <button class="filter-select list-columns-trigger" id="btn-list-columns" type="button" aria-expanded="false">
            âš™ è¡¨ç¤ºé …ç›®è¨­å®š
          </button>
          <div class="list-columns-menu" id="list-columns-menu" style="display:none;">
            <div class="list-columns-menu-content" id="list-columns-menu-content"></div>
          </div>
        </div>
      </div>

      <div class="table-wrapper" id="table-wrapper">
        <div class="table-scroll">
          <table id="customer-table">
            <thead>
              <tr>
                <th data-sort="shootingDate"><span data-i18n="thShootingDate">æ’®å½±æ—¥</span> <span
                    class="sort-arrow">â–¼</span></th>
                <th data-sort="inquiryDate"><span data-i18n="thInquiryDate">å•ã„åˆã‚ã›æ—¥</span> <span
                    class="sort-arrow">â–¼</span></th>
                <th data-sort="contractDate"><span data-i18n="thContractDate">æˆç´„æ—¥</span> <span
                    class="sort-arrow">â–¼</span></th>
                <th data-sort="customerName"><span data-i18n="thCustomerName">ãŠå®¢æ§˜å</span> <span
                    class="sort-arrow">â–¼</span></th>
                <th data-sort="contact"><span data-i18n="thContact">é€£çµ¡å…ˆ</span> <span class="sort-arrow">â–¼</span></th>
                <th data-sort="meetingDate"><span data-i18n="thMeetingDate">æ‰“ã¡åˆã‚ã›æ—¥</span> <span
                    class="sort-arrow">â–¼</span></th>
                <th data-sort="plan"><span data-i18n="thPlan">ãƒ—ãƒ©ãƒ³</span> <span class="sort-arrow">â–¼</span></th>
                <th data-sort="revenue"><span data-i18n="thRevenue">å£²ä¸Š</span> <span class="sort-arrow">â–¼</span></th>
                <th data-sort="paymentChecked"><span data-i18n="thPayment">å…¥é‡‘</span> <span class="sort-arrow">â–¼</span>
                </th>
                <th data-sort="assignedTo"><span data-i18n="thPhotographer">æ‹…å½“</span> <span class="sort-arrow">â–¼</span>
                </th>
                <th data-i18n="thActions">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="customer-tbody"></tbody>
          </table>
        </div>
        <div class="table-footer">
          <span id="table-count">0 ä»¶</span>
          <span id="table-revenue-total">Total: $0</span>
        </div>
      </div>
      <div class="customer-card-grid" id="customer-card-grid"></div>

      <div class="empty-state" id="empty-state" style="display:none;">
        <div class="empty-icon">ğŸ“·</div>
        <h3 data-i18n="emptyStateTitle">No customers yet</h3>
        <p data-i18n="emptyStateDesc">Start by adding your first customer to manage your shoots.</p>
        <button class="btn btn-primary btn-lg" onclick="openModal()" data-i18n="emptyStateBtn">
          â• Add First Customer
        </button>
      </div>
    </div>

    <!-- ===== Calendar View ===== -->
    <div class="calendar-view" id="calendar-view">
      <div class="calendar-nav-wrap">
        <div class="calendar-nav">
          <button class="btn-icon" id="cal-prev" title="å‰æœˆ" aria-label="å‰æœˆ" data-i18n-title="calPrev">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path d="M12.5 4.5L7 10l5.5 5.5" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
          <h2 id="cal-title">2026å¹´2æœˆ</h2>
          <button class="btn-icon" id="cal-next" title="æ¬¡æœˆ" aria-label="æ¬¡æœˆ" data-i18n-title="calNext">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path d="M7.5 4.5L13 10l-5.5 5.5" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
          <button class="btn btn-secondary btn-sm" id="cal-today" data-i18n="calToday">ä»Šæœˆ</button>
        </div>
        <div class="calendar-filters" aria-label="Calendar event filters">
          <label class="calendar-filter-item">
            <input type="checkbox" class="calendar-filter-input" value="inquiryDate" checked>
            <span data-i18n="calendarFilterInquiry">å•ã„åˆã‚ã›æ—¥</span>
          </label>
          <label class="calendar-filter-item">
            <input type="checkbox" class="calendar-filter-input" value="meetingDate" checked>
            <span data-i18n="calendarFilterMeeting">æ‰“ã¡åˆã‚ã›æ—¥</span>
          </label>
          <label class="calendar-filter-item">
            <input type="checkbox" class="calendar-filter-input" value="shootingDate" checked>
            <span data-i18n="calendarFilterShooting">æ’®å½±æ—¥</span>
          </label>
          <label class="calendar-filter-item">
            <input type="checkbox" class="calendar-filter-input" value="billingDate" checked>
            <span data-i18n="calendarFilterBilling">è«‹æ±‚æ—¥</span>
          </label>
        </div>
      </div>
      <div class="calendar-grid-scroll">
        <div class="calendar-grid" id="calendar-grid"></div>
      </div>
      <div class="calendar-legend">
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--accent);"></span>
          <span data-i18n="legendShooting">Photoshoot</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--success);"></span>
          <span data-i18n="legendMeeting">Meeting</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--warning);"></span>
          <span data-i18n="legendInquiry">Inquiry</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background: var(--pink);"></span>
          <span data-i18n="legendBilling">Payment Due</span>
        </div>
      </div>
    </div>

  </div>

  <!-- ===== Add/Edit Modal ===== -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal modal-form">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">
          <span class="modal-icon">ğŸ‘¤</span>
          <span data-i18n="modalAddTitle">New Customer</span>
        </h2>
        <button class="btn-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <form id="customer-form" class="form-grid">
          <input type="hidden" id="form-id" />

          <div class="form-section-title" data-i18n="secBasic">åŸºæœ¬æƒ…å ±</div>
          <div class="form-group">
            <label for="form-inquiryDate" data-i18n="labelInquiryDate">å•ã„åˆã‚ã›æ—¥</label>
            <input type="date" id="form-inquiryDate" />
          </div>
          <div class="form-group">
            <label for="form-contractDate" data-i18n="labelContractDate">æˆç´„æ—¥</label>
            <input type="date" id="form-contractDate" />
          </div>
          <div class="form-group">
            <label for="form-customerName" data-i18n="labelCustomerName">ãŠå®¢æ§˜å *</label>
            <input type="text" id="form-customerName" required placeholder="ä¾‹: å±±ç”° èŠ±å­"
              data-i18n-placeholder="placeholderCustomerName" />
          </div>
          <div class="form-group">
            <label for="form-contact" data-i18n="labelContact">é€£çµ¡å…ˆï¼ˆInsta / ãƒ¡ãƒ¼ãƒ«ï¼‰</label>
            <input type="text" id="form-contact" placeholder="ä¾‹: @yamada_hanako"
              data-i18n-placeholder="placeholderContact" />
          </div>
          <div class="form-group">
            <label for="form-assignedTo" data-i18n="labelAssignedTo">æ‹…å½“ã‚«ãƒ¡ãƒ©ãƒãƒ³</label>
            <select id="form-assignedTo">
              <option value="" data-i18n="selectDefault">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          <div class="form-group">
            <label for="form-location" data-i18n="labelLocation">Location</label>
            <input type="text" id="form-location" placeholder="e.g., Central Park, Studio A">
          </div>

          <div class="form-section-title" data-i18n="secShooting">æ’®å½±æƒ…å ±</div>
          <div class="form-group">
            <label for="form-shootingDate" data-i18n="labelShootingDate">æ’®å½±æ—¥</label>
            <input type="date" id="form-shootingDate" />
          </div>
          <div class="form-group">
            <label for="form-meetingDate" data-i18n="labelMeetingDate">æ‰“ã¡åˆã‚ã›æ—¥</label>
            <input type="date" id="form-meetingDate" />
          </div>
          <div class="form-group">
            <label for="form-plan" data-i18n="labelPlan">ãƒ—ãƒ©ãƒ³</label>
            <select id="form-plan">
              <option value="" data-i18n="selectDefault">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          <div class="form-group">
            <label for="form-costume" data-i18n="labelCostume">è¡£è£…</label>
            <select id="form-costume">
              <option value="" data-i18n="selectDefault">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          <div class="form-group">
            <label for="form-hairMakeup" data-i18n="labelHairMakeup">ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯</label>
            <select id="form-hairMakeup">
              <option value="" data-i18n="selectDefault">é¸æŠã—ã¦ãã ã•ã„</option>
            </select>
          </div>
          <div class="form-group">
            <label for="form-costume-price">è¡£è£…ä»£</label>
            <input type="number" id="form-costume-price" min="0" step="1" readonly />
          </div>
          <div class="form-group">
            <label for="form-hairmakeup-price">ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ä»£</label>
            <input type="number" id="form-hairmakeup-price" min="0" step="1" readonly />
          </div>
          <div id="custom-fields-container" class="custom-fields-container"></div>
          <div class="form-group full-width">
            <button type="button" class="btn btn-secondary" id="btn-add-custom-field" style="width:100%;">
              <span data-i18n="addCustomField">ï¼‹ Add Custom Field</span>
            </button>
          </div>

          <div class="form-section-title" data-i18n="secPayment">æ”¯æ‰•ã„æƒ…å ±</div>
          <div class="form-group">
            <label for="form-revenue" data-i18n="labelRevenue">å£²ä¸Šï¼ˆå††ï¼‰</label>
            <input type="number" id="form-revenue" min="0" step="1" placeholder="ä¾‹: 150000"
              data-i18n-placeholder="placeholderRevenue" />
          </div>
          <div class="form-group">
            <label for="form-billingDate" data-i18n="labelBillingDate">è«‹æ±‚æ—¥</label>
            <input type="date" id="form-billingDate" />
          </div>
          <div class="checkbox-wrapper">
            <input type="checkbox" id="form-paymentChecked" />
            <label for="form-paymentChecked" data-i18n="labelPaymentChecked">å…¥é‡‘ãƒã‚§ãƒƒã‚¯æ¸ˆã¿</label>
          </div>

          <div class="form-section-title">ãƒ—ãƒ©ãƒ³è©³ç´°</div>
          <div class="form-group">
            <label for="form-plan-name">æ’®å½±ãƒ—ãƒ©ãƒ³å</label>
            <input type="text" id="form-plan-name" placeholder="ä¾‹: Standard" />
          </div>
          <div class="form-group">
            <label for="form-base-price">åŸºæœ¬æ–™é‡‘</label>
            <input type="number" id="form-base-price" min="0" step="1" placeholder="ä¾‹: 120000" />
          </div>
          <div class="form-group">
            <label for="form-price-adjustment">æ‰‹å‹•èª¿æ•´é¡</label>
            <input type="number" id="form-price-adjustment" step="1" placeholder="ä¾‹: -5000 / +10000" />
          </div>
          <div class="form-group" style="grid-column: 1 / -1;">
            <label for="form-plan-options">ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®</label>
            <textarea id="form-plan-options"
              placeholder="ä¾‹: ã‚¢ãƒ«ãƒãƒ  +20000&#10;ãƒ¬ã‚¿ãƒƒãƒè¿½åŠ  +10000"></textarea>
          </div>
          <div class="form-group">
            <label for="form-total-price">åˆè¨ˆé‡‘é¡</label>
            <input type="number" id="form-total-price" min="0" step="1" placeholder="ä¾‹: 150000" />
          </div>

          <div class="form-section-title" data-i18n="secMemo">ãƒ¡ãƒ¢</div>
          <div class="form-group full-width">
            <label for="form-details" data-i18n="labelDetails">è©³ç´°</label>
            <textarea id="form-details" placeholder="æ’®å½±ã®è©³ç´°æƒ…å ±..." data-i18n-placeholder="placeholderDetails"></textarea>
          </div>
          <div class="form-group full-width">
            <label for="form-notes" data-i18n="labelNotes">å‚™è€ƒ</label>
            <textarea id="form-notes" placeholder="ãã®ä»–ãƒ¡ãƒ¢..." data-i18n-placeholder="placeholderNotes"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-primary" id="btn-save" onclick="saveCustomer()" data-i18n="save">Save Customer</button>
      </div>
    </div>
  </div>

  <!-- Customer Detail Modal -->
  <div class="modal-overlay" id="detail-overlay" style="display:none;">
    <div class="modal modal-detail">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="modal-icon">ğŸ‘¤</span>
          <span data-i18n="customerDetails">Customer Details</span>
        </h3>
        <button class="btn-close" onclick="closeDetailModal()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="detail-grid" id="detail-body-container">
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelCustomerName">Customer Name</label>
            <p class="detail-value" id="detail-name">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelContact">Contact</label>
            <p class="detail-value" id="detail-contact">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelShootingDate">Shooting Date</label>
            <p class="detail-value" id="detail-shooting-date">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelLocation">Location</label>
            <p class="detail-value" id="detail-location">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelPlan">Plan</label>
            <p class="detail-value" id="detail-plan">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelRevenue">Revenue</label>
            <p class="detail-value" id="detail-revenue">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label">æ’®å½±ãƒ—ãƒ©ãƒ³å</label>
            <p class="detail-value" id="detail-plan-name">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label">åŸºæœ¬æ–™é‡‘</label>
            <p class="detail-value" id="detail-base-price">â€”</p>
          </div>
          <div class="detail-item" style="grid-column: 1 / -1;">
            <label class="detail-label">ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®</label>
            <p class="detail-value" id="detail-plan-options" style="white-space: pre-line;">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label">åˆè¨ˆé‡‘é¡</label>
            <p class="detail-value" id="detail-total-price">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelPayment">Payment Status</label>
            <p class="detail-value" id="detail-payment">â€”</p>
          </div>
          <div class="detail-item">
            <label class="detail-label" data-i18n="labelNotes">Notes</label>
            <p class="detail-value" id="detail-notes">â€”</p>
          </div>
          <div class="detail-item full-width"
            style="grid-column: 1 / -1; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h3 style="font-size: 1.1rem; margin: 0;">
                <span data-i18n="taskManagement">Tasks</span>
                <span id="task-progress"
                  style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; margin-left: 10px;">0%</span>
              </h3>
              <button class="btn btn-primary btn-sm" onclick="openTaskModal()">
                <span data-i18n="addTask">â• Add Task</span>
              </button>
            </div>
            <div id="task-list" class="task-list" style="display: grid; gap: 10px;"></div>
          </div>
        </div>
        <!-- Hidden legacy body for JS compatibility if needed -->
        <div id="detail-body" style="display:none;"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDetailModal()">
          <span data-i18n="close">Close</span>
        </button>
        <button class="btn btn-secondary" id="detail-invoice-btn">
          <span data-i18n="generateInvoice">ğŸ“„ Create Invoice</span>
        </button>
        <button class="btn btn-primary" id="detail-edit-btn">
          <span data-i18n="edit">âœï¸ Edit</span>
        </button>
        <button class="btn btn-danger" id="detail-delete-btn">
          <span data-i18n="delete">ğŸ—‘ï¸ Delete</span>
        </button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="settings-overlay">
    <div class="modal" style="max-width:650px;">
      <div class="modal-header">
        <h2 class="modal-title">
          <span class="modal-icon">âš™ï¸</span>
          <span data-i18n="settingsTitle">Settings</span>
        </h2>
        <button class="btn-close" onclick="closeSettings()">âœ•</button>
      </div>
      <div class="modal-body">
        <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:20px;" data-i18n="settingsDesc">
          å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é¸æŠè‚¢ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚è¿½åŠ ã—ãŸé¸æŠè‚¢ã¯ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
        </p>
        <div class="settings-tabs">
          <button class="settings-tab-btn active" data-tab="menu" data-i18n="settings">General</button>
          <button class="settings-tab-btn" data-tab="invoice" data-i18n="invoiceSettings">Invoice & Tax</button>
          <button class="settings-tab-btn" data-tab="contract">å¥‘ç´„æ›¸è¨­å®š</button>
          <button class="settings-tab-btn" data-tab="team" data-i18n="teamManager">Team</button>
        </div>
        <div class="settings-tab-content active" id="settings-content-menu">
          <div class="settings-section">
            <h3 data-i18n="currency">Currency</h3>
            <div class="settings-add-box">
              <select id="currency-select">
                <option value="USD">USD ($)</option>
                <option value="JPY">JPY (Â¥)</option>
                <option value="EUR">EUR (â‚¬)</option>
              </select>
            </div>
          </div>
          <div class="settings-list" id="settings-list"></div>
        </div>

        <div class="settings-tab-content" id="settings-content-invoice">
          <div class="settings-section">
            <h3 data-i18n="taxSettings">Tax Settings</h3>
            <div class="form-group-row" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
              <input type="checkbox" id="tax-enabled" style="width: auto;">
              <label for="tax-enabled" data-i18n="enableTax" style="margin: 0;">Enable tax calculation</label>
            </div>
            <div id="tax-options" style="display: none;">
              <div class="form-group">
                <label data-i18n="taxRate">Tax Rate (%)</label>
                <input type="number" id="tax-rate" value="10" step="0.1">
                <p class="help-text" data-i18n="taxRateHelp">Enter your local tax rate (e.g., 10 for 10%)</p>
              </div>
              <div class="form-group" id="tax-label-group">
                <label data-i18n="taxLabel">Tax Label</label>
                <select id="tax-label">
                  <option value="Tax">Tax</option>
                  <option value="VAT">VAT (EU)</option>
                  <option value="GST">GST</option>
                  <option value="Sales Tax">Sales Tax (US)</option>
                  <option value="æ¶ˆè²»ç¨" data-i18n="taxLabelJapan">æ¶ˆè²»ç¨ (Japan)</option>
                  <option value="Custom">Custom...</option>
                </select>
                <input type="text" id="tax-label-custom" style="display: none; margin-top: 5px;"
                  placeholder="Custom tax label...">
              </div>
              <div class="form-group-row" id="tax-included-group"
                style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="tax-included" style="width: auto;">
                <label for="tax-included" data-i18n="taxIncluded" style="margin: 0;">Prices include tax</label>
              </div>
            </div>
          </div>
          <div class="settings-section" style="margin-top: 25px;">
            <h3 data-i18n="invoiceSettings">Invoice Settings</h3>
            <div class="form-group">
              <label data-i18n="companyName">Company Name</label>
              <input type="text" id="invoice-company-name">
            </div>
            <div class="form-group">
              <label data-i18n="companyAddress">Company Address</label>
              <textarea id="invoice-address" style="min-height: 60px;"></textarea>
            </div>
            <div class="form-group-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group">
                <label data-i18n="companyEmail">Email</label>
                <input type="email" id="invoice-email">
              </div>
              <div class="form-group">
                <label data-i18n="companyPhone">Phone</label>
                <input type="tel" id="invoice-phone">
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="bankInfo">Bank Information (optional)</label>
              <textarea id="invoice-bank" style="min-height: 80px;"></textarea>
            </div>
            <div class="form-group">
              <label for="invoice-template" data-i18n="invoiceTemplate">Invoice Template</label>
              <select id="invoice-template">
                <option value="modern" data-i18n="invoiceTemplateModern">Modern</option>
                <option value="classic" data-i18n="invoiceTemplateClassic">Classic</option>
                <option value="minimal" data-i18n="invoiceTemplateMinimal">Minimal</option>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-save-invoice-settings" data-i18n="saveSettings"
              style="width: 100%; margin-top: 15px;">Save Settings</button>
          </div>
        </div>
        <div class="settings-tab-content" id="settings-content-team">
          <div class="team-management">
            <h3 data-i18n="teamList">Team Members</h3>
            <div id="team-list" class="team-list"></div>
            <div class="team-add-form">
              <h3 data-i18n="addMember">Add Member</h3>
              <div class="form-group">
                <input type="text" id="team-new-name" data-i18n-placeholder="placeholderMemberName" />
                <select id="team-new-role">
                  <option value="photographer" data-i18n="rolePhotog">Photographer</option>
                  <option value="admin" data-i18n="roleAdmin">Admin</option>
                  <option value="assistant" data-i18n="roleAsst">Assistant</option>
                </select>
                <button class="btn btn-primary btn-sm" id="btn-team-add" data-i18n="addMember">Add</button>
              </div>
            </div>
          </div>
        </div>
        <div class="settings-tab-content" id="settings-content-contract">
          <div class="settings-section">
            <h3>å¥‘ç´„æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
            <p class="help-text">åˆ©ç”¨å¯èƒ½ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: <code>{{customer_name}}</code>, <code>{{shooting_date}}</code>, <code>{{total_price}}</code>, <code>{{plan_name}}</code>, <code>{{location}}</code>, <code>{{contact}}</code></p>
            <div class="form-group">
              <label for="contract-template-editor">æœ¬æ–‡ï¼ˆè‡ªç”±ç·¨é›†ï¼‰</label>
              <textarea id="contract-template-editor" style="min-height: 260px;"></textarea>
            </div>
            <div class="contract-preset-grid">
              <button type="button" class="btn btn-secondary btn-sm" id="btn-contract-preset-standard">æ¨™æº–çš„ãªæ’®å½±è¦ç´„ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼è¾¼ï¼‰</button>
              <button type="button" class="btn btn-secondary btn-sm" id="btn-contract-preset-bridal">ãƒ–ãƒ©ã‚¤ãƒ€ãƒ«ç‰¹åŒ–å‹å¥‘ç´„ï¼ˆæ‹˜æŸæ™‚é–“é‡è¦–ï¼‰</button>
              <button type="button" class="btn btn-secondary btn-sm" id="btn-contract-preset-light">ãƒ©ã‚¤ãƒˆãªè¦ç´„ï¼ˆSNSæ²è¼‰ç¢ºèªãªã©ï¼‰</button>
            </div>
            <button type="button" class="btn btn-primary" id="btn-save-contract-template" style="width:100%; margin-top: 12px;">å¥‘ç´„æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeSettings()" data-i18n="settingsDone">å®Œäº†</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="confirm-overlay" style="display:none;">
    <div class="modal modal-confirm">
      <div class="modal-header modal-header-danger">
        <h3 class="modal-title">
          <span class="modal-icon">âš ï¸</span>
          <span data-i18n="confirmDelete">Confirm Delete</span>
        </h3>
        <button class="btn-close" onclick="closeConfirmModal()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="confirm-message">
          <p data-i18n="confirmDeleteMessage">
            Are you sure you want to delete this customer? This action cannot be undone.
          </p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeConfirmModal()">
          <span data-i18n="cancel">Cancel</span>
        </button>
        <button class="btn btn-danger" id="btn-confirm-delete">
          <span data-i18n="confirmDelete">Delete</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== Toast Container ===== -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Contract Template Modal -->
  <div class="modal-overlay" id="contract-modal" style="display:none;">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="selectTemplate">Select Contract Template</h3>
        <button class="btn-close" onclick="closeContractModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="template-grid" style="display: grid; grid-template-columns: 1fr; gap: 10px;">
          <button class="btn btn-secondary contract-template-btn" data-template="wedding"
            style="justify-content: flex-start;">
            <span style="font-size: 1.5rem; margin-right: 15px;">ğŸ’’</span>
            <span data-i18n="wedding">Wedding</span>
          </button>
          <button class="btn btn-secondary contract-template-btn" data-template="portrait"
            style="justify-content: flex-start;">
            <span style="font-size: 1.5rem; margin-right: 15px;">ğŸ‘¤</span>
            <span data-i18n="portrait">Portrait</span>
          </button>
          <button class="btn btn-secondary contract-template-btn" data-template="commercial"
            style="justify-content: flex-start;">
            <span style="font-size: 1.5rem; margin-right: 15px;">ğŸ¢</span>
            <span data-i18n="commercial">Commercial</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Modal -->
  <div class="modal-overlay" id="task-modal" style="display:none;">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="addTask">Add Task</h3>
        <button class="btn-close" onclick="closeTaskModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label data-i18n="taskName">Task Name</label>
          <input type="text" id="task-name" placeholder="e.g., Send contract">
        </div>
        <div class="form-group">
          <label data-i18n="dueDate">Due Date</label>
          <input type="date" id="task-due-date">
        </div>
        <div class="form-group">
          <label data-i18n="priority">Priority</label>
          <select id="task-priority">
            <option value="low" data-i18n="low">Low</option>
            <option value="medium" data-i18n="medium" selected>Medium</option>
            <option value="high" data-i18n="high">High</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeTaskModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-primary" onclick="window.saveTask()" data-i18n="addTask">Add Task</button>
      </div>
    </div>
  </div>

  <!-- Expense Modal -->
  <div class="modal-overlay" id="expense-modal" style="display:none;">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h3 class="modal-title" data-i18n="addExpense">Add Expense</h3>
        <button class="btn-close" onclick="closeExpenseModal()">âœ•</button>
      </div>
      <form class="modal-body" id="expense-form">
        <div class="form-group">
          <label data-i18n="dueDate">Date</label>
          <input type="date" id="expense-date">
        </div>
        <div class="form-group">
          <label data-i18n="category">Category</label>
          <select id="expense-category">
            <option value="Equipment" data-i18n="equipment">Equipment</option>
            <option value="Software" data-i18n="software">Software</option>
            <option value="Travel" data-i18n="travel">Travel</option>
            <option value="Marketing" data-i18n="marketing">Marketing</option>
            <option value="Assistant/Staff" data-i18n="assistantStaff">Assistant/Staff</option>
            <option value="Studio Rent" data-i18n="studioRent">Studio Rent</option>
            <option value="Other" data-i18n="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label data-i18n="description">Description</label>
          <input type="text" id="expense-item" placeholder="e.g., New Lens">
        </div>
        <div class="form-group">
          <label data-i18n="amount">Amount</label>
          <input type="number" id="expense-amount" placeholder="0.00">
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" onclick="closeExpenseModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-primary" id="addExpenseBtn" type="submit" form="expense-form" data-i18n="addExpense">Add Expense</button>
      </div>
    </div>
  </div>

  <!-- Invoice Builder Modal -->
  <div class="modal-overlay" id="invoice-builder-modal" style="display:none;">
    <div class="modal" style="max-width: 860px;">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="modal-icon">ğŸ§¾</span>
          <span data-i18n="generateInvoice">Create Invoice</span>
        </h3>
        <button class="btn-close" onclick="closeInvoiceBuilderModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="invoice-customer-meta" id="invoice-customer-meta"></div>
        <div class="form-grid" style="margin-bottom:14px;">
          <div class="form-group">
            <label>Sender Name</label>
            <input type="text" id="invoice-sender-name" placeholder="Your name or studio name">
          </div>
          <div class="form-group">
            <label>Recipient Name</label>
            <input type="text" id="invoice-recipient-name" placeholder="Client name">
          </div>
          <div class="form-group">
            <label>Sender Contact (optional)</label>
            <input type="text" id="invoice-sender-contact" placeholder="Email / Phone / Instagram">
          </div>
          <div class="form-group">
            <label>Recipient Contact (optional)</label>
            <input type="text" id="invoice-recipient-contact" placeholder="Email / Phone / Instagram">
          </div>
          <div class="form-group">
            <label data-i18n="labelBillingDate">Invoice Date</label>
            <input type="date" id="invoice-issue-date">
          </div>
          <div class="form-group">
            <label data-i18n="dueDate">Due Date</label>
            <input type="date" id="invoice-due-date">
          </div>
        </div>
        <div class="invoice-item-header">
          <h4>Line Items</h4>
          <button class="btn btn-secondary btn-sm" id="btn-add-invoice-item">ï¼‹ Add Item</button>
        </div>
        <div class="invoice-item-table">
          <div class="invoice-item-table-head">
            <span>Description</span>
            <span>Qty</span>
            <span>Unit Price</span>
            <span>Amount</span>
            <span></span>
          </div>
          <div id="invoice-items-container"></div>
        </div>
        <div class="invoice-summary" id="invoice-builder-summary"></div>
        <div class="form-group" style="margin-top: 14px;">
          <label for="invoice-message">å‚™è€ƒãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
          <textarea id="invoice-message" placeholder="ã“ã®åº¦ã¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚" style="min-height: 100px;"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeInvoiceBuilderModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-primary" id="btn-generate-custom-invoice">ğŸ“„ Generate PDF</button>
      </div>
    </div>
  </div>

  <!-- PhotoCRM Scripts v2.2.3 -->
  <script>console.log('ğŸ“¦ Loading PhotoCRM v2.2.3 (Fixed btoa encoding error)...');</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-service.js"></script>
  <script src="locales.js"></script>
  <script src="invoice-generator.js"></script>
  <script src="team-manager.js"></script>
  <script src="sync-manager.js"></script>
  <script src="app.js"></script>
</body>

</html>
